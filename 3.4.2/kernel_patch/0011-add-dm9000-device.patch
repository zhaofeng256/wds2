From a7f3a995bea92ec5b37c40bd9271c9535844f997 Mon Sep 17 00:00:00 2001
From: zhaofeng256 <zhaofeng256@foxmail.com>
Date: Sun, 24 Mar 2019 11:33:34 +0800
Subject: [PATCH 11/13] add dm9000 device

Signed-off-by: zhaofeng256 <zhaofeng256@foxmail.com>
---
 arch/arm/mach-s3c24xx/mach-smdk2440.c | 42 +++++++++++++++++++++++++++
 1 file changed, 42 insertions(+)
 mode change 100644 => 100755 arch/arm/mach-s3c24xx/mach-smdk2440.c

diff --git a/arch/arm/mach-s3c24xx/mach-smdk2440.c b/arch/arm/mach-s3c24xx/mach-smdk2440.c
old mode 100644
new mode 100755
index b92c2bd5..ed9487f8
--- a/arch/arm/mach-s3c24xx/mach-smdk2440.c
+++ b/arch/arm/mach-s3c24xx/mach-smdk2440.c
@@ -22,6 +22,7 @@
 #include <linux/serial_core.h>
 #include <linux/platform_device.h>
 #include <linux/io.h>
+#include <linux/dm9000.h>
 
 #include <asm/mach/arch.h>
 #include <asm/mach/map.h>
@@ -151,12 +152,53 @@ static struct s3c2410fb_mach_info smdk2440_fb_info __initdata = {
 	.lpcsel		= ((0xCE6) & ~7) | 1<<4,
 };
 
+/* DM9000AEP 10/100 ethernet controller */
+
+#define MACH_SMDK2440_DM9K_BASE (S3C2410_CS4 + 0x300)
+
+static struct resource smdk2440_dm9k_resource[] = {
+	[0] = {
+		.start = MACH_SMDK2440_DM9K_BASE,
+		.end   = MACH_SMDK2440_DM9K_BASE + 3,
+		.flags = IORESOURCE_MEM
+	},
+	[1] = {
+		.start = MACH_SMDK2440_DM9K_BASE + 4,
+		.end   = MACH_SMDK2440_DM9K_BASE + 7,
+		.flags = IORESOURCE_MEM
+	},
+	[2] = {
+		.start = IRQ_EINT7,
+		.end   = IRQ_EINT7,
+		.flags = IORESOURCE_IRQ | IORESOURCE_IRQ_HIGHEDGE,
+	}
+};
+
+/*
+ * The DM9000 has no eeprom, and it's MAC address is set by
+ * the bootloader before starting the kernel.
+ */
+static struct dm9000_plat_data smdk2440_dm9k_pdata = {
+	.flags		= (DM9000_PLATF_16BITONLY | DM9000_PLATF_NO_EEPROM),
+};
+
+static struct platform_device s3c_device_eth = {
+	.name		= "dm9000",
+	.id		= -1,
+	.num_resources	= ARRAY_SIZE(smdk2440_dm9k_resource),
+	.resource	= smdk2440_dm9k_resource,
+	.dev		= {
+		.platform_data	= &smdk2440_dm9k_pdata,
+	},
+};
+
 static struct platform_device *smdk2440_devices[] __initdata = {
 	&s3c_device_ohci,
 	&s3c_device_lcd,
 	&s3c_device_wdt,
 	&s3c_device_i2c0,
 	&s3c_device_iis,
+	&s3c_device_eth,
 };
 
 static void __init smdk2440_map_io(void)
-- 
2.17.1

